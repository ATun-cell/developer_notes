以追加的方式保存Redis每一次写操作命令，重启Redis的时候读取这个文件并重新执行这些命令
默认关闭

# 三种AOF日志写回硬盘时机策略
![[Pasted image 20250521160918.png]]
三种写回策略，控制的就是上面说的第三步的过程
![[Pasted image 20250521161049.png]]

# AOF重写机制
****
避免AOF文件越写越大，超过设定的阈值后就会启动重写机制来压缩文件

具体是读取当前数据库中的所有键值对，然后将每一个键值用一条命令记录到新的AOF文件，等到全部记录完后，新的文件替换旧的文件

这样做是删除对键值对修改操作时产生的写操作

# AOF后台重写
重写的操作是由后台子进程bgrewriteaof来完成的
为什么不是用线程，因为线程之间是共享内存数据的，需要加锁来保证数据的安全，影响性能。
子进程带有主进程的数据副本，并且有写时复制机制。发生写操作的时候操作系统才会去复制物理内存，否则只是父子进程拥有相同的虚拟内存映射表来共享内存，权限是只读，发生写操作时会触发中断，接着进行写时复制操作

整个AOF后台重写过程中，除了发生写时复制会对主进程造成阻塞，还有信号处理函数造成阻塞，其它时候AOF后胎重写都不会阻塞主进程