# 为什么需要Redis Cluster
主从模式每个节点存储的数据是一样的，并且不好在线扩容
因此Redis Cluster集群，对数据进行分片，每台Redis节点存储不同的内容解决在线扩容的问题，可以保存大量数据，分散数据到各个Redis实例，还提供复制和故障转移功能

# 客户端是怎样知道该访问哪个分片的
哈希槽（Hash Slot）处理数据和实例之间的的映射关系
![[Pasted image 20250524103615.png]]

# 实力上并没有相应数据会怎么样
集群模式下，节点对请求的处理过程如下
- 通过哈希槽映射，检查当前Redis key是否存在当前节点
- 若哈希槽不是由自身节点负责，就返回MOVED重定向
- 确实由自身负责，且Key在slot中，返回结果
- 若Key不存在，检查该哈希槽是否正在迁出
- 如果正在迁出，返回ASK错误重定向客户端到迁移的目标服务器上
- 如未迁出，检查哈希槽是否导入中
- 若导入中且由ASKINTG标记，则直接操作，否则返沪MOVED重定向

## Moved重定向
![[Pasted image 20250524104117.png]]
## ASK重定向
一般发生在集群伸缩的时候，集群伸缩会导致槽迁移
![[Pasted image 20250524104240.png]]

# 各个节点之间是怎么通信的
通过Gossip协议，是一种谣言传播协议，每个节点周期性的从从节点列表中选择k个节点，将本节点存储的信息传播出去，直到所有节点信息一直，即算法收敛了
![[Pasted image 20250524104632.png]]

# 集群内节点出现故障怎么办
可以看原文