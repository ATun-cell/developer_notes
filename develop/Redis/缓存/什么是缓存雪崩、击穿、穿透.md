缓存雪崩、缓存击穿、缓存穿透

# 缓存雪崩
大量缓存数据在同一时间过期或者Redis故障宕机，如果此时有大量的用户请求，都无法在Redis中处理，于是全部请求直接访问数据库，导致数据库的压力骤增，严重的会造成数据库宕机，从而形成一系列连锁反应，造成整个系统奔溃，这就是缓存雪崩的问题
两个原因
不同的诱因，应对的策略也会不同
## 大量数据同时过期
1. 均匀设置过期时间
	避免将大量数据设置成同一个过期时间
2. 互斥锁
	业务线程处理用户请求时，如果发现访问的数据不在Redis里，价格互斥锁保证同一时间只有一个请求来构建缓存
3. 后台更新缓存
	![[Pasted image 20250524112616.png]]

## Redis服务宕机
1. 服务熔断或请求限流机制
	启动服务熔断机制暂停业务对缓存服务的访问直接返回错误，不用再继续访问数据库，等到Redis恢复正常后，再允许业务应用访问缓存服务。为了减少对业务的影响，我们可以启用请求限流机制，只将少部分请求发送到数据库进行处理，再多的请求就在入口直接拒绝服务
2. 构建Redis缓存高可靠集群

# 缓存击穿
热点数据过期，此时大量的请求访问了该热点数据，直接访问数据库，很容易就被高并发的请求击垮，这就是缓存击穿问题
可以采取前面说到的两种方案
- 互斥锁方案
- 不给热点数据设置过期时间，由后台异步更新缓存，或者再热点数据准备要过期前，提前通知后台线程更新缓存以及重新设置过期时间
# 缓存穿透
用户访问的数据，即不再缓存中也不再数据库种，导致请求再访问缓存时发现缓存缺失，再去访问数据库时，发现数据库种也没有要访问的数据，没办法构建缓存数据来服务后续的请求。那么当有大量这样的请求到来时，数据库的压力骤增，这就是缓存穿透的问题
一般两种情况
- 业务误操作，缓存中的数据喝数据库中的数据都被误删除了
- 给黑客攻击
方案有三种
- 非法请求的限制，判断请求参数是否合理请求字段是否存在
- 缓存空值或者默认值，不会继续擦汗寻数据库
- 通过布隆过滤器快速判断数据是否存在，避免通过查询数据库来判断数据是否存在
