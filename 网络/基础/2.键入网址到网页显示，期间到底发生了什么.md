# 孤单小弟--HTTP
*浏览器做的第一步工作是解析URL*
解析URL后，浏览器确定了web服务器和文件名，接下来根据这些信息来生成HTTP请求信息。
![[Pasted image 20250509170917.png]]

# 真实地址查询--DNS
****
生成HTTP消息后，还需要再DNS服务器中查询服务器域名对应的IP地址才能委托操作系统将消息发送出去

DNS服务器是用来保存web服务器域名与IP地址的对应关系
域名解析的工作流程：
1. 客户端会发出一个DNS请求，并发给本低DNS服务器也就是客户端的TCP/IP设置中填写的DN服务器地址
2. 本地域名如果缓存里的表格能找到则直接返回IP地址，找不到则会请求根域名服务器，剩下的步骤在图中
![[Pasted image 20250509185337.png]]
但是，浏览器也不是每次都要请求本低DNS服务器，而是先去查看自身缓存有没有，没有就去问操作系统，操作系统也会查自己的缓存，如果没有再去hosts文件看，没有再去问本地服务器
****
# 协议栈
****
通过DNS获取到IP后，就可以把HTTP的传输工作交给操作系统中的协议栈

协议栈结构图，上面的委托下面的进行工作
![[Pasted image 20250509190140.png]]
应用程序（浏览器）通过调用Sockert库，委托协议栈工作，协议栈的上半部分有两块，分别是负责收发数据的TCP协议和UDP协议，这两个传输协议会接受应用层的委托执行收发数据的操作

协议栈的下面一半使用IP协议控制网络包收发操作，在互联网上传数据时，数据会被切分为一块块的网络包，而将网络包发送给对方的操作就是有IP负责的

此外IP中还包括，ICMP协议和ARP协议
- ICMP用于告知网络包传送过程中产生的错误以及各种控制信息
- ARP用于根据IP地址查询相应的以太网MAC地址
IP下面的网卡驱动程序负责控制网卡硬件，而最下面的网卡负责完成时机的收发操作，也就是对网线中的信号执行发送和接受操作
****
# 可靠传输--TCP
****
HTTP时基于TCP协议传输的
![[Pasted image 20250509192153.png]]
![[Pasted image 20250509192314.png]]

TCP传输数据之前，要线三次握手建立连接
这个所谓的连接，只是双方计算机里维护一个状态机，在建立连接的过程中，双方的状态变化时序图就像这样
![[Pasted image 20250509192607.png]]
![[Pasted image 20250509192733.png]]
三次握手的目的是保证双方都有发送和接受的能力

如果HTTP请求消息比较长，超过了MSS的长度，TCP就需要把消息拆解成一块块的数据发送
MTU：一个网络包的最大长度，以太网一般为1500字节
MSS：出去IP和TCP头部之后，一个网络包能容纳的TCP数据的最大长度
![[Pasted image 20250509193055.png]]

TCP报文里数据部分装的是HTTP报文（HTTP头部加数据）
****
# 远程定位--IP

![[Pasted image 20250509193740.png]]
当客户端存在多张网卡，在填写源地址IP时，就需要根据路由表规则，来判断哪一个网关作为源地址IP

****
# 两点传输--MAC
****
![[Pasted image 20250509193935.png]]
在TCP/IP通信里，MAC包头的协议类型只使用
- 0800  IP协议
- 0806  ARP协议

发送方地址的获取，在网卡的ROM里
接收方的MAC地址，需要通过ARP协议，ARP协议会在以太网中以广播的形式，如果对方和自己处于同一个子网中，那么通过上面的操作就可以得到对方的MAC地址，操作系统也会把本次查询结果放到一块叫做ARP缓存的内存空间留着以后用，不过缓存的时间也就几分钟

****
# 出口--网卡
![[Pasted image 20250509195216.png]]
****
# 送别者--交换机
电信号到达网线接口，交换机里的模块进行接受，接下来交换机里的模块将电信号转换为数字信号。然后通过包末尾的FCS校验错误，如果没问题则放到缓冲区。

计算机的网卡本身具有MAC地址，并通过核对收到的包的接受方MAC地址判断是不是发给自己的，如果不是则丢弃，相对的，交换机对MAC地址不进行核对而是接受所有的包并存到缓冲区。交换机的端口不具有MAC地址
如果MAC地址表有目标MAC地址，则会发送到MAC地址表相应的端口，如果没有，则向除了源端口外的所有端口

****
# 出境大门--路由器
****
路由器和交换机的区别：
- 路由器是基于IP设计的，俗称三层网络设备，路由器的各个端口都具有MAC地址和IP地址
- 交换机是基于以太网设计的，俗称二层网络设备，端口不具有MAC地址

转发包时，首先路由器端口会接受发给自己的以太网包，然后路由表查询转发目标，再由相应的端口作为发送发将以太网包发送过去

接受包时，首先电信号到达网线接口部分，路由器中的模块会将电信号转成数字信号，然后通过包末尾的FCS进行错误校验，再检查接收方MAC地址，看看是不是发送给自己的。然后会丢弃包开头的MAC头部，因为MAC地址的作用就是找到目标路由器
接下来路由器会根据IP头部进行包的转发操作
首先查询路由表判断转发目标，IP地址和子网掩码进行按位与操作和路由表中缓存的数据进行对比

路由器的发送操作
首先需要路由表的网关列判断对方的地址，
- 如果网关地址是一个IP地址，则这个IP地址就是我们要转发到的目标地址，还未抵达终点，则继续需要路由器进行转发
- 如果网关为空，则IP头部中接收方IP地址就是要转发到的目标地址，也是就是终于找到IP包头里的目标地址了，说明已抵达终点
知道对方的IP地址后接下来需要通过ARP协议根据IP地址查询MAC地址，并将查询结果作为接收方MAC地址，
然后将发送方MAC地址字段，修改为输出端口的MAC地址
然后发送网络包
经过路由器层层转发后网络包就到达了最终的目的地

在传输过程中，源IP和目标IP始终是不会变的，一直变化的时MAC地址，因为需要MAC地址在以太网中进行两个设备之间的包传播

****
# 服务器与客户端
![[Pasted image 20250509203946.png]]